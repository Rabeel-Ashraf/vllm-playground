<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vLLM WebUI - Server Management & Chat Interface</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>üöÄ vLLM WebUI</h1>
                <div class="status-indicator">
                    <span id="status-dot" class="status-dot"></span>
                    <span id="status-text">Disconnected</span>
                    <span id="uptime" class="uptime"></span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Sidebar - Configuration -->
            <aside class="sidebar resizable" id="config-panel">
                <div class="panel">
                    <h2>‚öôÔ∏è Server Configuration</h2>
                    
                    <div class="form-group">
                        <label for="model-select">Model</label>
                        <select id="model-select" class="form-control">
                            <option value="TinyLlama/TinyLlama-1.1B-Chat-v1.0" selected>TinyLlama/TinyLlama-1.1B-Chat-v1.0</option>
                            <option value="RedHatAI/Llama-3.2-1B-Instruct-FP8">RedHatAI/Llama-3.2-1B-Instruct-FP8</option>
                            <option value="RedHatAI/Meta-Llama-3.1-8B-Instruct-FP8">RedHatAI/Meta-Llama-3.1-8B-Instruct-FP8</option>
                        </select>
                        <small class="form-help">All models support chat interface</small>
                        <input type="text" id="custom-model" class="form-control" placeholder="Custom model name">
                    </div>

                    <!-- CPU/GPU Mode Toggle -->
                    <div class="form-group mode-toggle-group">
                        <label>Compute Mode</label>
                        <div class="mode-toggle-buttons">
                            <label class="mode-button active" id="mode-cpu-label">
                                <input type="radio" name="compute-mode" id="mode-cpu" value="cpu" checked>
                                <span>üñ•Ô∏è CPU</span>
                            </label>
                            <label class="mode-button" id="mode-gpu-label">
                                <input type="radio" name="compute-mode" id="mode-gpu" value="gpu">
                                <span>üéÆ GPU</span>
                            </label>
                        </div>
                        <small class="form-help" id="mode-help-text">CPU mode is recommended for macOS</small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="host">Host</label>
                            <input type="text" id="host" class="form-control" value="0.0.0.0">
                        </div>
                        <div class="form-group">
                            <label for="port">Port</label>
                            <input type="number" id="port" class="form-control" value="8000">
                        </div>
                    </div>

                    <!-- GPU-specific settings (hidden in CPU mode) -->
                    <div id="gpu-settings">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="tensor-parallel">Tensor Parallel Size</label>
                                <input type="number" id="tensor-parallel" class="form-control" value="1" min="1">
                            </div>
                            <div class="form-group">
                                <label for="gpu-memory">GPU Memory (%)</label>
                                <input type="number" id="gpu-memory" class="form-control" value="90" min="10" max="100" step="5">
                            </div>
                        </div>
                    </div>

                    <!-- CPU-specific settings (shown in CPU mode) -->
                    <div id="cpu-settings" style="display: block;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cpu-kvcache">CPU KV Cache Space (GB)</label>
                                <input type="number" id="cpu-kvcache" class="form-control" value="40" min="1" max="200">
                                <small class="form-help">Memory allocated for KV cache</small>
                            </div>
                            <div class="form-group">
                                <label for="cpu-threads">CPU Thread Binding</label>
                                <select id="cpu-threads" class="form-control">
                                    <option value="auto">Auto (Recommended)</option>
                                    <option value="cores">Cores</option>
                                    <option value="none">None</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="dtype">Data Type</label>
                        <select id="dtype" class="form-control">
                            <option value="auto">Auto</option>
                            <option value="float16">Float16</option>
                            <option value="bfloat16" selected>BFloat16</option>
                            <option value="float32">Float32</option>
                        </select>
                        <small class="form-help" id="dtype-help-text">BFloat16 recommended for CPU</small>
                    </div>

                    <div class="form-group">
                        <label for="max-model-len">Max Model Length (optional)</label>
                        <input type="number" id="max-model-len" class="form-control" placeholder="Auto">
                        <small class="form-help">‚ö†Ô∏è Leave empty for auto-detect. Setting too high may cause errors.</small>
                    </div>

                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="trust-remote-code">
                            <span>Trust Remote Code</span>
                        </label>
                    </div>

                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="enable-prefix-caching">
                            <span>Enable Prefix Caching</span>
                        </label>
                    </div>

                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="disable-log-stats">
                            <span>Disable Log Stats</span>
                        </label>
                    </div>

                    <!-- Command Preview Section -->
                    <div class="command-preview-section">
                        <div class="command-preview-header">
                            <h3>üñ•Ô∏è Command Preview</h3>
                            <button id="copy-command-btn" class="btn btn-secondary btn-sm" title="Copy command">üìã Copy</button>
                        </div>
                        <textarea id="command-text" class="command-preview-textarea" rows="8" spellcheck="false">python -m vllm.entrypoints.openai.api_server --model facebook/opt-125m</textarea>
                        <small class="command-help">üí° Edit the command directly or use the form above. Your edits will be used when starting the server.</small>
                    </div>

                    <div class="button-group">
                        <button id="start-btn" class="btn btn-primary">‚ñ∂Ô∏è Start Server</button>
                        <button id="stop-btn" class="btn btn-danger" disabled>‚èπÔ∏è Stop Server</button>
                    </div>
                </div>
                <div class="resize-handle resize-handle-vertical" data-direction="horizontal"></div>
            </aside>

            <!-- Center - Chat Interface -->
            <main class="chat-section resizable" id="chat-panel">
                <div class="panel">
                    <div class="panel-header">
                        <h2>üí¨ Chat Interface</h2>
                        <button id="clear-chat-btn" class="btn btn-secondary btn-sm" style="min-width: 80px; padding: 6px 16px;">Clear</button>
                    </div>
                    
                    <div id="chat-container" class="chat-container">
                        <div class="chat-message system">
                            <div class="message-content">
                                <strong>System:</strong> Start the vLLM server and begin chatting with your model.
                            </div>
                        </div>
                    </div>

                    <div class="chat-input-area">
                        <div class="generation-params">
                            <div class="param-group">
                                <label for="temperature">Temperature: <span id="temp-value">0.7</span></label>
                                <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.7">
                            </div>
                            <div class="param-group">
                                <label for="max-tokens">Max Tokens: <span id="tokens-value">512</span></label>
                                <input type="range" id="max-tokens" min="1" max="4096" step="1" value="512">
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <textarea id="chat-input" class="chat-input" placeholder="Type your message here..." rows="3"></textarea>
                            <button id="send-btn" class="btn btn-primary" disabled>Send</button>
                        </div>
                    </div>
                </div>
                
                <!-- Chat Performance Metrics Section -->
                <div class="chat-metrics-below">
                    <div class="panel-header">
                        <h3>üìä Last Response Metrics</h3>
                    </div>
                    <div id="chat-metrics" class="chat-metrics-grid">
                        <div class="chat-metric-item">
                            <span class="metric-label">Prompt Tokens:</span>
                            <span class="metric-value" id="metric-prompt-tokens">-</span>
                        </div>
                        <div class="chat-metric-item">
                            <span class="metric-label">Completion Tokens:</span>
                            <span class="metric-value" id="metric-completion-tokens">-</span>
                        </div>
                        <div class="chat-metric-item">
                            <span class="metric-label">Total Tokens:</span>
                            <span class="metric-value" id="metric-total-tokens">-</span>
                        </div>
                        <div class="chat-metric-item">
                            <span class="metric-label">Time Taken:</span>
                            <span class="metric-value" id="metric-time-taken">-</span>
                        </div>
                        <div class="chat-metric-item">
                            <span class="metric-label">Tokens/sec:</span>
                            <span class="metric-value" id="metric-tokens-per-sec">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="resize-handle resize-handle-vertical" data-direction="horizontal"></div>
            </main>

            <!-- Right Panel - Logs -->
            <aside class="logs-section resizable" id="logs-panel">
                <div class="panel">
                    <div class="panel-header">
                        <h2>üìã Server Logs</h2>
                        <button id="clear-logs-btn" class="btn btn-secondary btn-sm" style="min-width: 80px; padding: 6px 16px;">Clear</button>
                    </div>
                    <div id="logs-container" class="logs-container">
                        <div class="log-entry info">Waiting for connection...</div>
                    </div>
                    <div class="logs-footer">
                        <label>
                            <input type="checkbox" id="auto-scroll" checked>
                            <span>Auto-scroll</span>
                        </label>
                    </div>
                </div>
            </aside>
        </div>

        <!-- Horizontal Resize Handle for Metrics Section -->
        <div class="resize-handle resize-handle-horizontal" id="metrics-resize-handle" data-direction="vertical"></div>

        <!-- Performance Metrics Section -->
        <section class="metrics-section resizable" id="metrics-panel">
            <div class="panel">
                <div class="panel-header">
                    <h2>üìä Performance Metrics (GuideLLM)</h2>
                    <div class="metrics-controls">
                        <button id="run-benchmark-btn" class="btn btn-primary btn-sm" disabled>‚ñ∂Ô∏è Run Benchmark</button>
                        <button id="stop-benchmark-btn" class="btn btn-danger btn-sm" disabled style="display: none;">‚èπÔ∏è Stop</button>
                    </div>
                </div>

                <!-- Benchmark Configuration -->
                <div class="benchmark-config">
                    <div class="config-row">
                        <div class="config-item">
                            <label for="benchmark-requests">Total Requests:</label>
                            <input type="number" id="benchmark-requests" class="form-control-sm" value="100" min="10" max="1000">
                        </div>
                        <div class="config-item">
                            <label for="benchmark-rate">Request Rate (req/s):</label>
                            <input type="number" id="benchmark-rate" class="form-control-sm" value="5" min="1" max="50">
                        </div>
                        <div class="config-item">
                            <label for="benchmark-prompt-tokens">Prompt Tokens:</label>
                            <input type="number" id="benchmark-prompt-tokens" class="form-control-sm" value="100" min="10" max="2048">
                        </div>
                        <div class="config-item">
                            <label for="benchmark-output-tokens">Output Tokens:</label>
                            <input type="number" id="benchmark-output-tokens" class="form-control-sm" value="100" min="10" max="2048">
                        </div>
                    </div>
                </div>

                <!-- Metrics Display -->
                <div id="metrics-display" class="metrics-display">
                    <div class="metrics-placeholder">
                        <p>‚è±Ô∏è No benchmark data available</p>
                        <p class="metrics-help">Start the vLLM server and click "Run Benchmark" to test performance</p>
                    </div>
                </div>

                <!-- Metrics Grid -->
                <div id="metrics-grid" class="metrics-grid" style="display: none;">
                    <!-- Throughput Metrics -->
                    <div class="metric-card">
                        <div class="metric-icon">üöÄ</div>
                        <div class="metric-label">Throughput</div>
                        <div class="metric-value" id="metric-throughput">-- req/s</div>
                        <div class="metric-subtext">Requests per second</div>
                    </div>

                    <!-- Latency Metrics -->
                    <div class="metric-card">
                        <div class="metric-icon">‚è±Ô∏è</div>
                        <div class="metric-label">Avg Latency</div>
                        <div class="metric-value" id="metric-latency">-- ms</div>
                        <div class="metric-subtext">Mean response time</div>
                    </div>

                    <!-- Tokens per Second -->
                    <div class="metric-card">
                        <div class="metric-icon">üìù</div>
                        <div class="metric-label">Token Throughput</div>
                        <div class="metric-value" id="metric-tokens-per-sec">-- tok/s</div>
                        <div class="metric-subtext">Output tokens per second</div>
                    </div>

                    <!-- P50 Latency -->
                    <div class="metric-card">
                        <div class="metric-icon">üìä</div>
                        <div class="metric-label">P50 Latency</div>
                        <div class="metric-value" id="metric-p50">-- ms</div>
                        <div class="metric-subtext">50th percentile</div>
                    </div>

                    <!-- P95 Latency -->
                    <div class="metric-card">
                        <div class="metric-icon">üìà</div>
                        <div class="metric-label">P95 Latency</div>
                        <div class="metric-value" id="metric-p95">-- ms</div>
                        <div class="metric-subtext">95th percentile</div>
                    </div>

                    <!-- P99 Latency -->
                    <div class="metric-card">
                        <div class="metric-icon">‚ö°</div>
                        <div class="metric-label">P99 Latency</div>
                        <div class="metric-value" id="metric-p99">-- ms</div>
                        <div class="metric-subtext">99th percentile</div>
                    </div>

                    <!-- Total Tokens -->
                    <div class="metric-card">
                        <div class="metric-icon">üí¨</div>
                        <div class="metric-label">Total Tokens</div>
                        <div class="metric-value" id="metric-total-tokens">--</div>
                        <div class="metric-subtext">Input + Output tokens</div>
                    </div>

                    <!-- Success Rate -->
                    <div class="metric-card">
                        <div class="metric-icon">‚úÖ</div>
                        <div class="metric-label">Success Rate</div>
                        <div class="metric-value" id="metric-success-rate">-- %</div>
                        <div class="metric-subtext">Successful requests</div>
                    </div>
                </div>

                <!-- Benchmark Progress -->
                <div id="benchmark-progress" class="benchmark-progress" style="display: none;">
                    <div class="progress-bar">
                        <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                    </div>
                    <div class="progress-text">
                        <span id="progress-status">Running benchmark...</span>
                        <span id="progress-percent">0%</span>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>

